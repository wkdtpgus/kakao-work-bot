"""
Intent Prompt ê²½ëŸ‰í™” ë²„ì „ í…ŒìŠ¤íŠ¸
ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ì™€ ê²½ëŸ‰í™” í”„ë¡¬í”„íŠ¸ì˜ ë¶„ë¥˜ ì •í™•ë„ ë¹„êµ
"""
import asyncio
import os
from pathlib import Path
from langchain_core.messages import SystemMessage, HumanMessage
from src.utils.models import get_chat_llm

# GCP ì¸ì¦ ì„¤ì • (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©)
project_root = Path(__file__).parent
credentials_path = project_root / "thetimecollabo-38646deba34a.json"
if credentials_path.exists():
    os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = str(credentials_path)
    print(f"âœ… GCP ì¸ì¦ íŒŒì¼ ì„¤ì •: {credentials_path}")
else:
    print(f"âš ï¸ GCP ì¸ì¦ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {credentials_path}")

# í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
TEST_CASES = [
    # ========== ê¸°ë³¸ ì¼€ì´ìŠ¤ ==========
    ("ìˆ˜ì • ë‚´ìš©ì„ ë°˜ì˜í•´ì„œ ë‹¤ì‹œ ì‘ì„±í•´", "ìš”ì•½ì„ ë³´ì—¬ë“œë ¸ìŠµë‹ˆë‹¤", "edit_summary"),
    ("ì¼ì¼ê¸°ë¡ ìˆ˜ì •í•´ì¤˜", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì•ˆí–ˆì–´. ì´ê±´ ë¹¼ì¤˜", "ìš”ì•½ ë‚´ìš©", "edit_summary"),
    ("ì •ë¦¬í•´ì¤˜", "", "summary"),
    ("ì‘", "ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ì‘", "ì˜¤ëŠ˜ í•˜ì‹  ì—…ë¬´ì— ëŒ€í•´ ì´ì•¼ê¸° ë‚˜ëˆ ë³¼ê¹Œìš”?", "continue"),
    ("ë", "", "end_conversation"),
    ("ì•„ë‹ˆ", "ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),
    ("ì•ˆí–ˆì–´", "í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì„ í•˜ì…¨ë‚˜ìš”?", "continue"),
    ("ì•ˆí–ˆì–´", "ìš”ì•½: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì™„ë£Œ", "edit_summary"),
    ("ì²˜ìŒë¶€í„° ë‹¤ì‹œ", "", "restart"),

    # ========== ìš”ì•½ ìš”ì²­ ë³€í˜• ==========
    ("ìš”ì•½í•´ì¤˜", "", "summary"),
    ("ì˜¤ëŠ˜ í•œ ê±° ì •ë¦¬í•´ì£¼ë©´ ì•ˆë¼?", "", "summary"),
    ("ë„¤", "ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ì¢‹ì•„", "ìš”ì•½í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ë¶€íƒí•´", "ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "summary"),

    # ========== ìš”ì•½ ìˆ˜ì • ë³€í˜• ==========
    ("ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ê·¸ ìˆ˜ì •ë„ ì¶”ê°€í•´ì¤˜", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì€ ë¹ ì ¸ìˆì–´", "ìš”ì•½ ë‚´ìš©", "edit_summary"),
    ("ì´ê±° í‹€ë ¸ì–´. ë‹¤ì‹œ ì‘ì„±í•´ì¤˜", "ìš”ì•½ì„ ë³´ì—¬ë“œë ¸ìŠµë‹ˆë‹¤", "edit_summary"),
    ("ì—¬ê¸° ëˆ„ë½ëœ ë¶€ë¶„ ìˆì–´", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("ìˆ˜ì •í•˜ê³  ì‹¶ì–´", "ìš”ì•½ ë‚´ìš©", "edit_summary"),
    ("ë°˜ì˜í•´ì¤˜", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),

    # ========== ì§§ì€ ì‘ë‹µ - ë§¥ë½ë³„ ==========
    ("ë„¤", "ì˜¤ëŠ˜ ì–´ë–¤ ì—…ë¬´ë¥¼ í•˜ì…¨ë‚˜ìš”?", "continue"),
    ("ì‘", "ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?", "continue"),
    ("ì¢‹ì•„", "ê·¸ ë°©ë²•ìœ¼ë¡œ ì§„í–‰í•˜ì…¨ë‚˜ìš”?", "continue"),
    ("ë„¤", "ìˆ˜ì •í•˜ê³  ì‹¶ì€ í‘œí˜„ì€ ì—†ë‚˜ìš”?", "no_edit_needed"),
    ("ì—†ì–´", "ìˆ˜ì •í•˜ê³  ì‹¶ì€ ë¶€ë¶„ ìˆë‚˜ìš”?", "no_edit_needed"),
    ("ê´œì°®ì•„", "ë””í…Œì¼ì€ ì—†ë‚˜ìš”?", "no_edit_needed"),

    # ========== ê±°ì ˆ ë³€í˜• ==========
    ("ì‹«ì–´", "ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),
    ("ë‚˜ì¤‘ì—", "ìš”ì•½í•´ë“œë¦´ê¹Œìš”?", "rejection"),
    ("ì•ˆ í• ë˜", "ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),

    # ========== ëŒ€í™” ì¢…ë£Œ ë³€í˜• ==========
    ("ì¢…ë£Œ", "", "end_conversation"),
    ("ê·¸ë§Œ", "", "end_conversation"),
    ("ë°”ì´", "", "end_conversation"),
    ("í˜ë“¤ì–´", "", "end_conversation"),
    ("í”¼ê³¤í•´", "", "end_conversation"),
    ("ì´ì œ ê·¸ë§Œ", "", "end_conversation"),
    ("ë§ˆì¹ ê²Œ", "", "end_conversation"),

    # ========== ì¬ì‹œì‘ ë³€í˜• ==========
    ("ìƒˆë¡œ ì‹œì‘", "", "restart"),
    ("ë¦¬ì…‹", "", "restart"),
    ("ë‹¤ì‹œ ì‹œì‘í•˜ì", "", "restart"),

    # ========== ì¼ë°˜ ëŒ€í™” (continue) ==========
    ("ì˜¤ëŠ˜ ì±—ë´‡ ê°œë°œí–ˆì–´", "", "continue"),
    ("ë²„ê·¸ ìˆ˜ì •í•˜ê³  í…ŒìŠ¤íŠ¸ ì‘ì„±í–ˆì–´", "", "continue"),
    ("ì—†ì—ˆì–´", "íŠ¹ë³„í•œ ì–´ë ¤ì›€ì€ ì—†ì—ˆë‚˜ìš”?", "continue"),
    ("ë”±íˆ", "ì–´ë–¤ ì ì´ ì–´ë ¤ì› ë‚˜ìš”?", "continue"),
    ("ê·¸ëƒ¥ í‰ì†Œì²˜ëŸ¼ í–ˆì–´", "", "continue"),
    ("API ì—°ë™ ì‘ì—… ì§„í–‰ ì¤‘ì´ì•¼", "", "continue"),

    # ========== ì—£ì§€ ì¼€ì´ìŠ¤ - "ì•ˆí–ˆì–´" ë§¥ë½ êµ¬ë¶„ ==========
    ("ì•ˆí–ˆì–´", "í…ŒìŠ¤íŠ¸ëŠ” ì‘ì„±í•˜ì…¨ë‚˜ìš”?", "continue"),  # ëŒ€í™” ì¤‘
    ("ì•ˆí–ˆì–´", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨\n\ní…ŒìŠ¤íŠ¸ ì‘ì„± ì™„ë£Œ", "edit_summary"),  # ìš”ì•½ í›„
    ("ì•ˆ í–ˆë‹¤ë‹ˆê¹Œ", "ë¦¬íŒ©í† ë§ë„ í•˜ì…¨ë‚˜ìš”?", "continue"),  # ëŒ€í™” ì¤‘
    ("ê·¸ê±° ì•ˆí–ˆì–´", "ìš”ì•½: ë¦¬íŒ©í† ë§ ì™„ë£Œ", "edit_summary"),  # ìš”ì•½ í›„

    # ========== ì—£ì§€ ì¼€ì´ìŠ¤ - ë‹¤ì‹œ ì‘ì„± ë§¥ë½ êµ¬ë¶„ ==========
    ("ë‹¤ì‹œ ì‘ì„±í•´", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),  # ìš”ì•½ ìˆ˜ì •
    ("ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•´ë³¼ê²Œ", "ì–´ë–»ê²Œ ì§„í–‰í•˜ì…¨ë‚˜ìš”?", "continue"),  # ì¼ë°˜ ëŒ€í™”

    # ========== ì—£ì§€ ì¼€ì´ìŠ¤ - ì• ë§¤í•œ ì§§ì€ ì‘ë‹µ ==========
    ("ì‘", "", "continue"),  # ë§¥ë½ ì—†ìœ¼ë©´ continue
    ("ë„¤", "", "continue"),  # ë§¥ë½ ì—†ìœ¼ë©´ continue
    ("ì¢‹ì•„", "", "continue"),  # ë§¥ë½ ì—†ìœ¼ë©´ continue

    # ========== ë³µí•© ì˜ë„ (ìš°ì„ ìˆœìœ„ í…ŒìŠ¤íŠ¸) ==========
    ("ëë‚´ê³  ì‹¶ì–´", "", "end_conversation"),  # end > continue
    ("ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ê³  ì‹¶ì–´", "", "restart"),  # restart > continue
    ("ìˆ˜ì •í•˜ê³  ëë‚¼ê²Œ", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),  # edit > end

    # ========== ì¶”ê°€ ìš”ì•½ ìš”ì²­ íŒ¨í„´ ==========
    ("ì •ë¦¬ ë¶€íƒí•´", "", "summary"),
    ("ìš”ì•½ ì¢€ í•´ì¤˜", "", "summary"),
    ("ì§€ê¸ˆê¹Œì§€ ì–˜ê¸°í•œ ê±° ì •ë¦¬í•´ì¤„ë˜?", "", "summary"),
    ("ì˜¤ëŠ˜ í•œ ì¼ ì •ë¦¬í•´ì£¼ì„¸ìš”", "", "summary"),
    ("ê¸°ë¡ ì •ë¦¬í•´ì¤˜", "", "summary"),
    ("ì˜¤ì¼€ì´", "ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ã…‡ã…‡", "ìš”ì•½í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ê·¸ë˜", "ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ì‘ì‘", "ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "summary"),

    # ========== ì¶”ê°€ ìš”ì•½ ìˆ˜ì • íŒ¨í„´ ==========
    ("ì´ê±° ì˜ëª»ëì–´", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨", "edit_summary"),
    ("ì´ ë¶€ë¶„ ìˆ˜ì •", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("ì—¬ê¸°ì— ì´ê²ƒë„ ë„£ì–´ì¤˜", "ìš”ì•½:", "edit_summary"),
    ("ê·¸ ë‚´ìš©ë„ ê¸°ë¡í•´ì¤˜", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨", "edit_summary"),
    ("íšŒì˜ ë‚´ìš©ë„ ì¶”ê°€í•´ì¤˜", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("ì´ í•­ëª© ë¹¼ì¤˜", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨", "edit_summary"),
    ("ë¬¸ì„œ ì‘ì„±ì€ ì•ˆ í–ˆì–´", "ìš”ì•½: ë¬¸ì„œ ì‘ì„± ì™„ë£Œ", "edit_summary"),
    ("ê·¸ê±´ í•˜ì§€ ì•Šì•˜ì–´", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨\n\nì½”ë“œ ë¦¬ë·°", "edit_summary"),
    ("ë‚´ìš© ì¢€ ë°”ê¿”ì¤˜", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("í‘œí˜„ ìˆ˜ì •í•´ì¤˜", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨", "edit_summary"),

    # ========== ì¶”ê°€ ëŒ€í™” ì¢…ë£Œ íŒ¨í„´ ==========
    ("ê·¸ë§Œí• ê²Œ", "", "end_conversation"),
    ("ì¢…ë£Œí• ê²Œ", "", "end_conversation"),
    ("ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€", "", "end_conversation"),
    ("ì´ë§Œ ëë‚¼ê²Œ", "", "end_conversation"),
    ("êµ¿ë°¤", "", "end_conversation"),
    ("ì˜ì", "", "end_conversation"),
    ("ë„ˆë¬´ í”¼ê³¤í•˜ë‹¤", "", "end_conversation"),
    ("ì§€ì³¤ì–´", "", "end_conversation"),
    ("ì˜¤ëŠ˜ì€ í˜ë“¤ì–´ì„œ ê·¸ë§Œí• ë˜", "", "end_conversation"),

    # ========== ì¶”ê°€ ê±°ì ˆ íŒ¨í„´ ==========
    ("ì•„ë‹ˆì•¼", "ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),
    ("ëì–´", "ìš”ì•½í•´ë“œë¦´ê¹Œìš”?", "rejection"),
    ("ê´œì°®ì•„", "ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),  # ìš”ì•½ ì œì•ˆì— ëŒ€í•œ ê±°ì ˆ
    ("ì•ˆ í•´", "ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),
    ("ë³„ë¡œ", "ìš”ì•½í•´ë“œë¦´ê¹Œìš”?", "rejection"),

    # ========== ì¶”ê°€ ì¼ë°˜ ëŒ€í™” íŒ¨í„´ ==========
    ("ì˜¤ëŠ˜ íšŒì˜ ë§ì•˜ì–´", "", "continue"),
    ("ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„í–ˆì–´", "", "continue"),
    ("íŒ€ì›ë“¤ì´ë‘ í˜‘ì—…í–ˆì–´", "", "continue"),
    ("ë¬¸ì„œ ì‘ì„±í•˜ê³  ë¦¬ë·° ë°›ì•˜ì–´", "", "continue"),
    ("ì½”ë“œ ë¦¬íŒ©í† ë§ ì§„í–‰ ì¤‘", "", "continue"),
    ("ë³„ì¼ ì—†ì—ˆì–´", "ì˜¤ëŠ˜ì€ ì–´ë–¤ ì¼ì„ í•˜ì…¨ë‚˜ìš”?", "continue"),
    ("í‰ë²”í–ˆì–´", "íŠ¹ë³„í•œ ì¼ì€ ì—†ì—ˆë‚˜ìš”?", "continue"),
    ("ê·¸ëƒ¥ ë£¨í‹´ëŒ€ë¡œ", "", "continue"),
    ("ìŒ...", "ì–´ë–¤ ì‘ì—…ì„ í•˜ì…¨ë‚˜ìš”?", "continue"),
    ("ê¸€ì„", "ì–´ë ¤ìš´ ì ì€ ì—†ì—ˆë‚˜ìš”?", "continue"),

    # ========== ì¶”ê°€ no_edit_needed íŒ¨í„´ ==========
    ("ì‘ ê´œì°®ì•„", "ìˆ˜ì •í•˜ê³  ì‹¶ì€ í‘œí˜„ì€ ì—†ë‚˜ìš”?", "no_edit_needed"),
    ("ì™„ë²½í•´", "ë””í…Œì¼ì€ ì—†ë‚˜ìš”?", "no_edit_needed"),
    ("ì˜ ëì–´", "ìˆ˜ì •í•˜ê³  ì‹¶ì€ ë¶€ë¶„ ìˆë‚˜ìš”?", "no_edit_needed"),
    ("ì´ëŒ€ë¡œ ì¢‹ì•„", "ìˆ˜ì •í•˜ê³  ì‹¶ì€ í‘œí˜„ì€ ì—†ë‚˜ìš”?", "no_edit_needed"),
    ("ìˆ˜ì •í•  ê±° ì—†ì–´", "ë””í…Œì¼ì€ ì—†ë‚˜ìš”?", "no_edit_needed"),

    # ========== ì¶”ê°€ ì¬ì‹œì‘ íŒ¨í„´ ==========
    ("ë‹¤ì‹œ ì‹œì‘í• ê²Œ", "", "restart"),
    ("ì˜¨ë³´ë”© ë‹¤ì‹œ", "", "restart"),
    ("ì˜¨ë³´ë”© ì´ˆê¸°í™”", "", "restart"),
    ("ì˜¨ë³´ë”© ì¬ì‹œì‘", "", "restart"),
    ("í”„ë¡œí•„ ì¬ì„¤ì •", "", "restart"),

    # ========== ë³µí•© í‘œí˜„ - ë§¥ë½ ì¤‘ìš” ==========
    ("ì—†ì–´", "ìˆ˜ì •í•˜ê³  ì‹¶ì€ í‘œí˜„ì€ ì—†ë‚˜ìš”?", "no_edit_needed"),  # ìˆ˜ì • ì—†ìŒ
    ("ì—†ì–´", "ì˜¤ëŠ˜ ì–´ë ¤ì›€ì€ ì—†ì—ˆë‚˜ìš”?", "continue"),  # ì¼ë°˜ ëŒ€í™”
    ("ì—†ì–´", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨\n\níšŒì˜", "edit_summary"),  # ìš”ì•½ ìˆ˜ì •
    ("ë³„ë¡œ", "ì–´ë–¤ ì ì´ ì–´ë ¤ì› ë‚˜ìš”?", "continue"),  # ì¼ë°˜ ëŒ€í™”
    ("ë³„ë¡œ", "ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),  # ìš”ì•½ ê±°ì ˆ
    ("ê·¸ëƒ¥", "ì–´ë–»ê²Œ ì§„í–‰í•˜ì…¨ë‚˜ìš”?", "continue"),  # ì¼ë°˜ ëŒ€í™”
    ("ì¢‹ì•„", "", "continue"),  # ë§¥ë½ ì—†ìŒ
    ("ì¢‹ì•„", "ì˜¤ëŠ˜ ì—…ë¬´ì— ëŒ€í•´ ì´ì•¼ê¸° ë‚˜ëˆ ë³¼ê¹Œìš”?", "continue"),  # ëŒ€í™” ì‹œì‘ ë™ì˜
    ("ì¢‹ì•„", "ìˆ˜ì •í•˜ê³  ì‹¶ì€ ë¶€ë¶„ ìˆë‚˜ìš”?", "no_edit_needed"),  # ìˆ˜ì • ì—†ìŒ

    # ========== ì‹¤ì œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ==========
    ("ë¯¸íŒ…ë„ ì¶”ê°€í•´ì¤˜", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨", "edit_summary"),
    ("ì´ê±´ ì˜¤ëŠ˜ ì•ˆ í–ˆëŠ”ë°?", "ìš”ì•½: í…ŒìŠ¤íŠ¸ ì‘ì„±", "edit_summary"),
    ("ë²„ê·¸ ìˆ˜ì • ë‚´ìš©ì´ ë¹ ì¡Œì–´", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—…ë„ í–ˆì–´", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨\n\në°±ì—”ë“œ ê°œë°œ", "edit_summary"),
    ("ì´ í‘œí˜„ ì¢€ ì´ìƒí•œë°", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("ì˜¤ëŠ˜ì€ ê·¸ëƒ¥ íšŒì˜ë§Œ í–ˆì–´", "", "continue"),
    ("íŠ¹ë³„í•œ ê±´ ì—†ì—ˆê³  ì¼ìƒì ì¸ ì—…ë¬´ë§Œ", "", "continue"),
    ("ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ ê³„ì† ì‘ì—…", "", "continue"),
    ("ì•„ì§ ì§„í–‰ ì¤‘ì´ì•¼", "ì™„ë£Œí•˜ì…¨ë‚˜ìš”?", "continue"),

    # ========== íƒ€ì´í¬/êµ¬ì–´ì²´ íŒ¨í„´ ==========
    ("ã…‡ã…‹", "ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ã„±ã„±", "ìš”ì•½í•´ë“œë¦´ê¹Œìš”?", "summary"),
    ("ã„´ã„´", "ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”?", "rejection"),
    ("ã…‚ã…‚", "", "end_conversation"),
    ("ã…‡ã…‡ ìˆ˜ì •", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("ì •ë¦¬ã„±ã„±", "", "summary"),

    # ========== ê¸´ ë¬¸ì¥/ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„ ==========
    ("ì˜¤ëŠ˜ í•œ ê±° ì •ë¦¬ ì¢€ ë¶€íƒë“œë ¤ë„ ë ê¹Œìš”?", "", "summary"),
    ("ì§€ê¸ˆê¹Œì§€ ì´ì•¼ê¸°í•œ ë‚´ìš©ì„ ìš”ì•½ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ë©´ ì¢‹ê² ì–´ìš”", "", "summary"),
    ("ìˆ˜ì •í•  ë¶€ë¶„ì´ ì¢€ ìˆëŠ”ë° ë‹¤ì‹œ ì‘ì„±í•´ì¤„ ìˆ˜ ìˆì–´?", "ìš”ì•½ ì™„ë£Œ", "edit_summary"),
    ("ìš”ì•½ ë‚´ìš© ì¤‘ì— í‹€ë¦° ë¶€ë¶„ì´ ìˆì–´ì„œ ìˆ˜ì •ì´ í•„ìš”í•´", "ğŸ“ ì˜¤ëŠ˜ì˜ ì»¤ë¦¬ì–´ ë©”ëª¨", "edit_summary"),
    ("ì˜¤ëŠ˜ì€ ì •ë§ í”¼ê³¤í•´ì„œ ì´ì œ ê·¸ë§Œí•˜ê³  ì‹¶ì–´", "", "end_conversation"),
    ("ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ê³  ì‹¶ì€ë° ê°€ëŠ¥í•´?", "", "restart"),

    # ========== ì• ë§¤í•œ í‘œí˜„ (ê¸°ë³¸ê°’ í…ŒìŠ¤íŠ¸) ==========
    ("ìŒ", "", "continue"),
    ("ì•„", "", "continue"),
    ("í ", "", "continue"),
    ("ê·¸ë ‡êµ¬ë‚˜", "", "continue"),
    ("ì•Œê² ì–´", "", "continue"),
    ("okay", "", "continue"),
    ("yes", "", "continue"),
]


async def test_intent_classification(system_prompt: str, user_prompt_template: str, test_name: str):
    """ì˜ë„ ë¶„ë¥˜ í…ŒìŠ¤íŠ¸"""
    llm = get_chat_llm()
    results = []

    print(f"\n{'='*60}")
    print(f"Testing: {test_name}")
    print(f"{'='*60}")

    for user_msg, bot_context, expected in TEST_CASES:
        # ë´‡ ì»¨í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì¶”ê°€
        if bot_context:
            enhanced_msg = f"[Previous bot]: {bot_context}\n[User]: {user_msg}"
        else:
            enhanced_msg = user_msg

        # LLM í˜¸ì¶œ
        user_prompt = user_prompt_template.format(message=enhanced_msg)
        response = await llm.ainvoke([
            SystemMessage(content=system_prompt),
            HumanMessage(content=user_prompt)
        ])

        classified = response.content.strip().lower()
        is_correct = classified == expected

        results.append({
            "message": user_msg,
            "bot_context": bot_context,
            "expected": expected,
            "classified": classified,
            "correct": is_correct
        })

        status = "âœ…" if is_correct else "âŒ"
        print(f"{status} '{user_msg[:30]}...' â†’ {classified} (expected: {expected})")

    # ì •í™•ë„ ê³„ì‚°
    correct_count = sum(1 for r in results if r["correct"])
    accuracy = (correct_count / len(results)) * 100

    print(f"\nì •í™•ë„: {correct_count}/{len(results)} ({accuracy:.1f}%)")

    return results, accuracy


async def main():
    """ê¸°ì¡´ vs ê²½ëŸ‰í™” ë²„ì „ ë¹„êµ"""

    # ê¸°ì¡´ í”„ë¡¬í”„íŠ¸
    from src.prompt.archive.intent_prompts_v2 import (
        INTENT_CLASSIFICATION_SYSTEM_PROMPT as OLD_SYS,
        INTENT_CLASSIFICATION_USER_PROMPT as OLD_USER
    )

    # ê²½ëŸ‰í™” í”„ë¡¬í”„íŠ¸
    from src.prompt.intent_prompts import (
        INTENT_CLASSIFICATION_SYSTEM_PROMPT as NEW_SYS,
        INTENT_CLASSIFICATION_USER_PROMPT as NEW_USER
    )

    # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    old_results, old_accuracy = await test_intent_classification(OLD_SYS, OLD_USER, "ê¸°ì¡´ í”„ë¡¬í”„íŠ¸")
    new_results, new_accuracy = await test_intent_classification(NEW_SYS, NEW_USER, "ê²½ëŸ‰í™” í”„ë¡¬í”„íŠ¸")

    # ë¹„êµ ê²°ê³¼
    print(f"\n{'='*60}")
    print("ìµœì¢… ë¹„êµ ê²°ê³¼")
    print(f"{'='*60}")
    print(f"ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ ì •í™•ë„: {old_accuracy:.1f}%")
    print(f"ê²½ëŸ‰í™” í”„ë¡¬í”„íŠ¸ ì •í™•ë„: {new_accuracy:.1f}%")
    print(f"ì°¨ì´: {new_accuracy - old_accuracy:+.1f}%")

    # ë¶ˆì¼ì¹˜ ì¼€ì´ìŠ¤ ë¶„ì„
    print(f"\n{'='*60}")
    print("ë¶„ë¥˜ ì°¨ì´ ë¶„ì„")
    print(f"{'='*60}")
    for i, (old, new) in enumerate(zip(old_results, new_results)):
        if old["classified"] != new["classified"]:
            print(f"\nì¼€ì´ìŠ¤ {i+1}: {old['message'][:40]}")
            print(f"  ê¸°ì¡´: {old['classified']} â†’ ê²½ëŸ‰í™”: {new['classified']}")
            print(f"  ì •ë‹µ: {old['expected']}")


if __name__ == "__main__":
    asyncio.run(main())
